name: Build Windows Release

on:
  push:
    tags:
      - 'vix-release-*'

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      # å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          choco install winflexbison
          choco install llvm
      
      # ç¼–è¯‘
      - name: Build
        run: |
          cd src
          make
        shell: bash
      
      # ä¸‹è½½ Clang-18 å®‰è£…åŒ…
      - name: Download Clang-18
        run: |
          # ä¸‹è½½ Clang-18 Windows å®‰è£…åŒ…
          curl -L -o clang-18.1.0-windows-x64.exe https://github.com/llvm/llvm-project/releases/download/llvmorg-18.1.0/LLVM-18.1.0-win64.exe
      
      # åˆ›å»º Release
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            bin/vixc.exe
            clang-18.1.0-windows-x64.exe
          name: Vixc ${{ github.ref_name }}
          tag_name: ${{ github.ref_name }}
          draft: false
          prerelease: ${{ contains(github.ref_name, 'beta') || contains(github.ref_name, 'alpha') }}
          body: |
            ## Vixc ç¼–è¯‘å™¨ ${{ github.ref_name }}
            
            ### ğŸªŸ Windows ç”¨æˆ·
            - `vixc.exe` - Vixc ç¼–è¯‘å™¨
            - `clang-18.1.0-windows-x64.exe` - Clang-18 å®‰è£…ç¨‹åº
            
            ### ğŸ“ å®‰è£…æ­¥éª¤
            1. å®‰è£… Clang-18ï¼ˆåŒå‡»è¿è¡Œï¼‰
            2. å®‰è£… Flex/Bisonï¼š`choco install winflexbison`
            3. å°† vixc.exe æ‰€åœ¨ç›®å½•æ·»åŠ åˆ° PATH
            4. æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œè¿è¡Œ `vixc -v` éªŒè¯
            
            ### ğŸ§ Linux ç”¨æˆ·
            Linux ç”¨æˆ·è¯·ç›´æ¥å…‹éš†æºç ç¼–è¯‘ï¼š
            ```bash
            git clone https://github.com/${{ github.repository }}.git
            cd vixc/src
            make
            sudo make install
            ```
            
            éœ€è¦ä¾èµ–ï¼šclang-18, flex, bison
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}